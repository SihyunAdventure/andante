# Andante MVP 구현 계획

## 프로젝트 개요

**Andante** — AI 데이팅 서비스. "천천히 알아간다"는 컨셉.
사용자의 아바타끼리 미리 대화를 주고받은 걸 보고 만남을 결정하는 서비스.

### 핵심 결정 사항
- **플랫폼**: Next.js 웹앱 (PWA)
- **아바타 대화**: 텍스트 + ElevenLabs 음성 재생
- **디자인**: 웜 파스텔 + 캐릭터 중심
- **개발**: 1인 개발
- **온보딩**: 음성 답변 → STT → 성격 분석 → 페르소나 생성
- **시장**: 한국 + 글로벌 (다국어)
- **수익**: 무료 가입 + 친구 초대로 데이팅 횟수 증가

### 기술 스택
| 레이어 | 기술 |
|--------|------|
| 프레임워크 | Next.js 14+ (App Router) |
| 스타일링 | Tailwind CSS + Framer Motion |
| 백엔드/DB | Supabase (PostgreSQL + Auth + Realtime + Storage) |
| AI 대화 | Claude API (페르소나 대리 대화) |
| STT | Deepgram Nova-3 (음성 → 텍스트) |
| TTS | ElevenLabs (대화 음성 재생) |
| 아바타 생성 | Replicate API (Stable Diffusion + IP-Adapter) |
| 배포 | Vercel |
| 언어 | TypeScript |

---

## Phase 1: 프로젝트 셋업 & 인프라

### 1.1 프로젝트 초기화
- Next.js 프로젝트 생성 (App Router, TypeScript)
- Tailwind CSS + 커스텀 테마 (웜 파스텔 컬러 시스템)
- Framer Motion 설치
- ESLint + Prettier 설정
- PWA 설정 (next-pwa)

### 1.2 Supabase 설정
- 프로젝트 생성
- DB 스키마 설계:
  - `users` — 기본 프로필 (이름, 사진, 언어 등)
  - `personas` — AI 페르소나 (Big Five 점수, 말투, 관심사, 시스템 프롬프트)
  - `avatars` — 아바타 이미지 (원본 사진, 생성된 아바타들)
  - `matches` — 매칭 기록 (상태: pending/active/completed/passed)
  - `conversations` — 아바타 대화 로그 (JSON)
  - `invites` — 초대 코드 + 추적
  - `dating_credits` — 데이팅 횟수 크레딧
- Row Level Security (RLS) 정책
- Supabase Auth (소셜 로그인: Google, Kakao)

### 1.3 배포 파이프라인
- Vercel 프로젝트 연결
- 환경변수 설정 (API 키들)
- 도메인 연결

---

## Phase 2: 디자인 시스템 & 랜딩 페이지

### 2.1 디자인 시스템
- **컬러 팔레트**: 웜 파스텔 (크림, 피치, 라벤더, 민트)
- **타이포그래피**: Pretendard (한국어) + Inter (영어)
- **컴포넌트 라이브러리**:
  - Button (primary, secondary, ghost)
  - Card (프로필 카드, 대화 카드)
  - Input (텍스트, 음성 녹음 버튼)
  - Modal, Toast, Progress Bar
  - Avatar 컴포넌트 (원형, 다양한 크기)
- **마이크로 인터랙션**: Framer Motion으로 전환/호버/탭 효과
- **다국어**: next-intl (한국어 + 영어)

### 2.2 랜딩 페이지
- 히어로 섹션: "아바타가 먼저 대화합니다" 컨셉 전달
- 3단계 설명: 음성 답변 → 아바타 생성 → 아바타 대화 관찰
- CTA: "무료로 시작하기"
- 소셜 프루프 섹션 (추후 추가)
- 반응형 디자인 (모바일 우선)

---

## Phase 3: 인증 & 온보딩

### 3.1 인증
- Supabase Auth (Google, Kakao 소셜 로그인)
- 로그인/회원가입 페이지
- 프로필 기본 정보 입력 (이름, 나이, 성별, 선호 성별)

### 3.2 음성 온보딩 (핵심 차별화)
- **질문 5-7개** (5분 이하 목표):
  1. "주말에 갑자기 약속이 취소되면 뭘 하세요?" (외향성)
  2. "최근에 마음이 따뜻해진 순간이 있나요?" (친화성)
  3. "스트레스 받을 때 어떻게 풀어요?" (신경성)
  4. "새로운 걸 시도하는 걸 좋아하세요? 예를 들면?" (개방성)
  5. "약속 잡을 때 계획파? 즉흥파?" (성실성)
  6. (선택) "어떤 유머를 좋아해요?" (유머 스타일)
  7. (선택) "이상적인 데이트는?" (관심사)
- **구현 플로우**:
  1. 질문 카드 표시 + 애니메이션
  2. 마이크 버튼 → 브라우저 MediaRecorder API로 녹음
  3. 실시간 음성 파형 시각화
  4. Deepgram Nova-3로 STT
  5. Claude API로 답변 분석 → Big Five + 말투 + 관심사 추출
  6. 진행 표시줄 + "성격 특성 발견!" 애니메이션
- **결과**: personas 테이블에 저장

### 3.3 아바타 생성
- 사진 업로드 (Supabase Storage)
- Replicate API 호출:
  - Stable Diffusion + IP-Adapter FaceID Plus V2
  - 웜 파스텔 스타일의 캐릭터 변환
  - 3가지 스타일 옵션 생성 → 사용자 선택
- 선택한 아바타 저장

---

## Phase 4: 매칭 & 아바타 대화

### 4.1 매칭 알고리즘
- 기본 필터: 나이 범위, 성별 선호, 위치 (선택)
- AI 호환성 예측: Big Five 점수 기반 궁합도 계산
- 하루 N명 매칭 추천 (무료: 3명, 초대 보너스: +1명/초대)

### 4.2 아바타 대화 시뮬레이션 (핵심 기능)
- **Claude API 기반 대리 대화**:
  - 시스템 프롬프트에 양쪽 사용자의 페르소나 주입
  - 시나리오 설정: "첫 만남", "관심사 탐색", "가치관 대화"
  - 턴 기반 대화 (각 10-15턴)
  - 각 턴마다 자연스러운 대화 생성
- **하이브리드 컨트롤** (Volar 실패 방지):
  - Tier 1: 아바타 자동 대화 (사용자는 관찰)
  - Tier 2: 사용자가 "이 주제로 대화해줘" 방향 제안 가능
  - 대화 중 실시간 호환성 힌트 표시 (예: "유머 코드가 맞아요!")
- **ElevenLabs 음성 재생**:
  - 각 아바타에 고유 음성 프로필 할당
  - 대화 메시지 옆 재생 버튼 → TTS로 음성 생성
  - 스트리밍 재생 (저지연)

### 4.3 대화 결과 & 매칭 점수
- 대화 완료 후 궁합 리포트:
  - 대화 자연스러움 점수
  - 공통 관심사
  - 커뮤니케이션 스타일 궁합
  - 종합 궁합도 (0-100)
- "만나볼래요" / "패스" 선택
- 양쪽 모두 "만나볼래요" → 실제 채팅 오픈

---

## Phase 5: 실제 채팅 & 프로필

### 5.1 실제 채팅
- Supabase Realtime으로 실시간 텍스트 채팅
- 메시지 입력 + 전송
- 읽음 표시
- 이미지 전송 (Supabase Storage)

### 5.2 프로필 페이지
- 내 아바타 + 실제 사진
- 성격 요약 (Big Five 레이더 차트)
- 매칭 히스토리
- 데이팅 크레딧 잔여량
- 초대 코드 & 공유 버튼

---

## Phase 6: 바이럴 그로스 & 크레딧 시스템

### 6.1 초대 시스템
- 고유 초대 코드 생성
- 카카오톡 / 링크 공유
- 추적: 누가 초대했는지, 가입 완료 여부
- 양방향 리워드: 초대자 +1 크레딧, 신규 유저 +1 크레딧

### 6.2 크레딧 시스템
- 가입 시 기본 3크레딧 (3번 매칭 가능)
- 친구 1명 초대 완료 → +1 크레딧
- 마일스톤: 5명 초대 → +3 보너스 크레딧
- 크레딧 사용: 매칭 1회 = 1크레딧

---

## Phase 7: 폴리싱 & 런치

### 7.1 UI 폴리싱
- 모든 페이지 전환 애니메이션 (Framer Motion)
- 로딩 상태 (스켈레톤 UI)
- 에러 핸들링 + 토스트 알림
- 다크 모드 (선택)
- SEO 메타태그

### 7.2 성능 최적화
- 이미지 최적화 (Next.js Image)
- API 라우트 캐싱
- 번들 사이즈 최적화

### 7.3 런치 준비
- 개인정보 처리방침 + 이용약관
- Google Analytics / Mixpanel
- 에러 모니터링 (Sentry)
- 베타 사용자 모집 (웨이트리스트 페이지)

---

## 구현 순서 요약

| 순서 | Phase | 핵심 산출물 |
|------|-------|------------|
| 1 | 셋업 & 인프라 | Next.js + Supabase + Vercel 기본 구조 |
| 2 | 디자인 시스템 & 랜딩 | 컴포넌트 라이브러리 + 랜딩 페이지 |
| 3 | 인증 & 온보딩 | 소셜 로그인 + 음성 온보딩 + 아바타 생성 |
| 4 | 매칭 & 아바타 대화 | 매칭 알고리즘 + AI 대화 시뮬레이션 + 음성 재생 |
| 5 | 실제 채팅 & 프로필 | 실시간 채팅 + 프로필 페이지 |
| 6 | 바이럴 & 크레딧 | 초대 시스템 + 크레딧 관리 |
| 7 | 폴리싱 & 런치 | 애니메이션, 성능, 법적 문서, 모니터링 |

---

## 주요 리스크 & 대응

| 리스크 | 대응 |
|--------|------|
| Volar식 실패 (사용자 통제감 부족) | 하이브리드 컨트롤 — 사용자가 대화 방향 제안 가능 |
| AI 대화 품질 부족 | Claude API + 정교한 페르소나 프롬프트 + 시나리오 설계 |
| API 비용 초과 | 대화 턴 수 제한 + 캐싱 + 음성 재생은 선택적 |
| 1인 개발 병목 | Phase별 우선순위 철저, MVP 범위 엄격 관리 |
| 한국어 STT 정확도 | Deepgram + Return Zero 비교 테스트 후 선택 |

---

## 디렉토리 구조 (예상)

```
andante/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── (auth)/             # 인증 관련 페이지
│   │   ├── (main)/             # 메인 앱 페이지
│   │   │   ├── dashboard/      # 대시보드 (매칭 추천)
│   │   │   ├── conversation/   # 아바타 대화 보기
│   │   │   ├── chat/           # 실제 채팅
│   │   │   ├── profile/        # 프로필
│   │   │   └── invite/         # 초대
│   │   ├── onboarding/         # 온보딩 플로우
│   │   ├── api/                # API Routes
│   │   └── layout.tsx
│   ├── components/
│   │   ├── ui/                 # 기본 UI 컴포넌트
│   │   ├── avatar/             # 아바타 관련
│   │   ├── chat/               # 채팅 관련
│   │   ├── onboarding/         # 온보딩 관련
│   │   └── layout/             # 레이아웃
│   ├── lib/
│   │   ├── supabase/           # Supabase 클라이언트
│   │   ├── ai/                 # AI 서비스 (Claude, Deepgram, ElevenLabs)
│   │   ├── avatar/             # 아바타 생성 (Replicate)
│   │   └── matching/           # 매칭 알고리즘
│   ├── hooks/                  # 커스텀 훅
│   ├── stores/                 # Zustand 상태
│   ├── types/                  # TypeScript 타입
│   ├── i18n/                   # 다국어 (ko, en)
│   └── styles/                 # 글로벌 스타일 + 테마
├── public/
├── supabase/
│   ├── migrations/             # DB 마이그레이션
│   └── seed.sql                # 시드 데이터
└── package.json
```
